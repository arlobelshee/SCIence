<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Retrospectives</title>
	<link rel="stylesheet" href="css/foundation.css"/>
	<link rel="stylesheet" href="css/app.css"/>
	<script src="js/vendor/modernizr.js"></script>
	<script src="js/vendor/jquery.js"></script>
	<script src="js/vendor/knockout-3.3.0.js"></script>
	<script src="js/foundation.min.js" type="text/javascript"></script>
	<script src="js/foundation/foundation.reveal.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			$(document).foundation();
			bindView(ko);
		});
	</script>
	<script type="text/javascript">
		var bindView = function bindView(ko) {
			var viewModel = {
				frequency: "bidaily",
				frequencies: [
					{
						id: "daily",
						text: "1 day",
						segment_options: [
							{id: "gather", duration: "5 min", activities: []},
							{id: "choose_problem", duration: "3 min", activities: []},
							{id: "roots", duration: "5 min", activities: []},
							{id: "choose_root", duration: "3 min", activities: []},
							{id: "solutions", duration: "3 min", activities: []},
							{id: "choose_solution", duration: "6 min", activities: []},
							{id: "define_experiment", duration: "5 min", activities: []},
							{id: "experiment", duration: "1 day", activities: []},
							{id: "results_experiment", duration: "3 min", activities: []},
							{id: "agree_solution", duration: "2 min", activities: []},
							{id: "define_change", duration: "5 min", activities: []},
							{id: "change_habit", duration: "1 day", activities: []},
							{id: "results_habit", duration: "3 min", activities: []}
						]
					},
					{
						id: "bidaily",
						text: "2 days",
						segment_options: [
							{id: "gather", duration: "10 min", activities: []},
							{id: "choose_problem", duration: "5 min", activities: ["cluster_and_dot", "combine"]},
							{id: "roots", duration: "10 min", activities: []},
							{id: "choose_root", duration: "3 min", activities: []},
							{id: "solutions", duration: "10 min", activities: []},
							{id: "choose_solution", duration: "5 min", activities: []},
							{id: "define_experiment", duration: "5 min", activities: []},
							{id: "experiment", duration: "2 days", activities: []},
							{id: "results_experiment", duration: "3 min", activities: []},
							{id: "agree_solution", duration: "5 min", activities: []},
							{id: "define_change", duration: "10 min", activities: []},
							{id: "change_habit", duration: "2 days", activities: []},
							{id: "results_habit", duration: "3 min", activities: []}
						]
					},
					{
						id: "weekly",
						text: "1 week",
						segment_options: [
							{id: "gather", duration: "25 min", activities: []},
							{id: "choose_problem", duration: "10 min", activities: []},
							{id: "roots", duration: "20 min", activities: []},
							{id: "choose_root", duration: "5 min", activities: []},
							{id: "solutions", duration: "20 min", activities: []},
							{id: "choose_solution", duration: "10 min", activities: []},
							{id: "define_experiment", duration: "5 min", activities: []},
							{id: "experiment", duration: "1 week", activities: []},
							{id: "results_experiment", duration: "3 min", activities: []},
							{id: "agree_solution", duration: "10 min", activities: []},
							{id: "define_change", duration: "10 min", activities: []},
							{id: "change_habit", duration: "1 week", activities: []},
							{id: "results_habit", duration: "3 min", activities: []}
						]
					},
					{
						id: "longer",
						text: "too damn long",
						segment_options: [
							{id: "gather", duration: "45 min", activities: []},
							{id: "choose_problem", duration: "15 min", activities: []},
							{id: "roots", duration: "30 min", activities: []},
							{id: "action_items", duration: "5 min", activities: []},
							{id: "do_work", duration: "2 days", activities: []},
							{id: "results_action", duration: "3 min", activities: []}
						]
					}
				],
				segments: {
					gather: {name: "Gather data"},
					choose_problem: {name: "Pick one improvement goal"},
					roots: {name: "Find contributing factors"},
					choose_root: {name: "Pick one contributing factor"},
					pick_style: {name: "Experiment or habit change?"},
					solutions: {name: "Generate solutions"},
					choose_solution: {name: "Pick one solution"},
					define_experiment: {name: "Define experiment"},
					experiment: {name: "Run experiment"},
					results_experiment: {name: "Analyze results"},
					agree_solution: {name: "Agree to solution"},
					define_change: {name: "Define habit change"},
					change_habit: {name: "Change the habit"},
					results_habit: {name: "Analyze results"},
					action_items: {name: "Pick action items"},
					do_work: {name: "Complete action items"},
					results_action: {name: "Analyze results"}
				},
				activities: {
					cluster_and_dot: {title: "Cluster and dot vote", uri: ""},
					combine: {title: "Combine top ideas", uri: ""}
				}
			};
			ko.components.register('segment', {
				template: {element: 'retro_segment_template'},
				viewModel: function (params) {
					this.segment = params.segment;
					this.root = params.root;
				}
			});
			viewModel.frequency = ko.observable(viewModel.frequency);
			var frequency_map = {};
			for (var i = 0; i < viewModel.frequencies.length; ++i) {
				var freq = viewModel.frequencies[i];
				freq.segment_options = ko.observable(freq.segment_options);
				frequency_map[freq.id] = freq;
				for (var j = 0; j < freq.segment_options().length; ++j) {
					var segment = freq.segment_options()[j];
					freq[segment.id] = segment;
					var acts = [];
					for (var k = 0; k < segment.activities.length; ++k) {
						var act = segment.activities[k];
						viewModel.activities[act].id = act;
						acts.push(viewModel.activities[act]);
					}
					segment.activities = acts;
				}
			}
			viewModel.retro_structure = ko.observable(null);
			var updateStructure = function updateStructure() {
				viewModel.retro_structure(frequency_map[viewModel.frequency()]);
			};
			updateStructure();
			viewModel.frequency.subscribe(updateStructure);
			ko.applyBindings(viewModel);
		};
	</script>
</head>
<body>
<script>
	document.createElement('segment');
</script>

<div class="row">
	<div class="large-12 columns">
		<h1>Change one thing</h1>

		<p>How long since your last retrospective?
			<!-- ko foreach: frequencies -->
			<input type="radio" name="experiment_cycle_time" data-bind="checked: $root.frequency, value: id, attr: {id: 'ect__'+id}" id="ect__"><label data-bind="attr: {for: 'ect__'+id}, text:text" for="ect__">duration</label>
			<!-- /ko -->
		</p>
	</div>
</div>

<div class="row">
	<div class="medium-8 column">
		<segment params="segment: retro_structure().gather, root: $root">
		</segment>

		<segment params="segment: retro_structure().choose_problem, root: $root">
			<p><label for="key_problem">Key problem:</label><input id="key_problem"></p>

			<p><label for="measure_effect">Measure &ndash; how you know it's fixed:</label><input id="measure_effect"></p>
		</segment>

		<segment params="segment: retro_structure().roots, root: $root">
		</segment>


		<segment params="segment: retro_structure().choose_root, root: $root">
		</segment>

		<segment params="segment: retro_structure().solutions, root: $root">
		</segment>

		<segment params="segment: retro_structure().choose_solution, root: $root">
		</segment>

		<segment params="segment: retro_structure().define_experiment, root: $root">
		</segment>

		<segment params="segment: retro_structure().experiment, root: $root">
		</segment>

		<segment params="segment: retro_structure().results_experiment, root: $root">
		</segment>

		<segment params="segment: retro_structure().agree_solution, root: $root">
		</segment>

		<segment params="segment: retro_structure().define_change, root: $root">
		</segment>

		<segment params="segment: retro_structure().change_habit, root: $root">
		</segment>

		<segment params="segment: retro_structure().results_habit, root: $root">
		</segment>

		<segment params="segment: retro_structure().action_items, root: $root">
		</segment>

		<segment params="segment: retro_structure().do_work, root: $root">
		</segment>

		<segment params="segment: retro_structure().results_action, root: $root">
		</segment>
	</div>
	<div class="medium-4 column panel">
		<ul class="side-nav nav-extra" data-bind="foreach: retro_structure().segment_options">
			<li><span data-bind="text: $parent.segments[id].name">Segment name</span> <span class="duration" data-bind="text: '(' + duration + ')'">(?? min)</span></li>
		</ul>
	</div>
</div>

<template id="retro_segment_template">
	<section data-bind="if: segment()">
		<h2 data-bind="text: root.segments[segment().id].name">Segment name</h2>

		<p><label data-bind="attr: {for: 'activities__' + segment().id}" for="some__activity">Activity
			<span data-bind="text: '(' + segment().duration + ')'" class="duration">(?? min)</span>:</label>
			<select id="some__activity" name="activity_for_something"
			        data-bind="foreach: segment().activities, attr: {id: 'activities__' + segment().id, name: 'activity_for_' + segment().id}">
				<option data-bind="value: id, text: title" value="cluster">Activity name</option>
			</select></p>
		<!-- ko template: { nodes: $componentTemplateNodes, data: segment } --><!-- /ko -->
	</section>
</template>
</body>
</html>
